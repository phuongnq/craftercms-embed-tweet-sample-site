(function () {

  'use strict';

  const TWEETER_JS_API_URL = 'https://platform.twitter.com/widgets.js';
  tinymce.PluginManager.add("embed_tweet_static", function (editor, url) {
    var dialogConfig =  {
      title: 'Input Tweet ID',
      body: {
        type: 'panel',
        items: [
          {
            type: 'input',
            name: 'tweetId',
            label: 'Enter Tweet ID'
          }
        ]
      },
      buttons: [
        {
          type: 'cancel',
          name: 'closeButton',
          text: 'Cancel'
        },
        {
          type: 'submit',
          name: 'submitButton',
          text: 'Insert Code',
          primary: true
        }
      ],
      initialData: {
        tweetId: '',
      },
      onSubmit: function (api) {
        var data = api.getData();
        console.log(data);
        var script = document.createElement('script');
        script.onload = function () {
          var doc = document.createElement('div');
          console.log(doc);
          window.twttr.widgets.createTweet(
            data.tweetId,
            doc,
            {}
          )
          .then(function (elm) {
            console.log(elm);
            tinymce.activeEditor.execCommand('mceInsertRawHTML', false, elm);
            api.close();
          });
        };
        script.src = TWEETER_JS_API_URL;
      }
    };

    function _showDialog() {
      editor.windowManager.open(dialogConfig);
    }

    // Define the Toolbar button
    editor.ui.registry.addButton('embed_tweet_static', {
        text: "Add Tweet Embed Static",
        onAction: _showDialog
    });
  });


  return {
    getMetadata: function () {
      return {
        name: "Embed Tweet Static",
        url: "http://exampleplugindocsurl.com"
      };
    }
  };
})();